# Terraform Destroy Pipeline

## üóëÔ∏è **–ü–∞–π–ø–ª–∞–π–Ω –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**

–°–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è–º–∏.

## ‚ö†Ô∏è **–í–ê–ñ–ù–û: –û—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º!**

–≠—Ç–æ—Ç –ø–∞–π–ø–ª–∞–π–Ω **–£–î–ê–õ–Ø–ï–¢ –í–°–Æ –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–£** –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —É–≤–µ—Ä–µ–Ω—ã!

## üîÑ **–¢—Ä–∏–≥–≥–µ—Ä—ã –ø–∞–π–ø–ª–∞–π–Ω–∞:**

### **–¢–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (workflow_dispatch):**
- **Environment:** dev, staging, prod
- **Confirm Destroy:** –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ "DESTROY"
- **Destroy EKS:** –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ EKS
- **Destroy Infra:** –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ Infra

## üìã **–≠—Ç–∞–ø—ã –ø–∞–π–ø–ª–∞–π–Ω–∞:**

### **1. Pre-destroy checks**
```yaml
- Checkout code
- Configure AWS credentials
- Setup Terraform 1.6.0
- Pre-destroy checks (–≤—ã–≤–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- List AWS resources before destroy
```

### **2. Terraform Destroy**
```yaml
- Terraform Destroy - EKS (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
- Terraform Destroy - Infra (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
```

### **3. Post-destroy cleanup**
```yaml
- Post-destroy cleanup
- Verify S3 state buckets
- Destroy summary
- Create destroy report
- Upload destroy report
```

## üöÄ **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

### **1. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GitHub UI:**
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Actions** ‚Üí **Terraform Destroy Infrastructure**
2. –ù–∞–∂–∞—Ç—å **Run workflow**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **Environment:** dev/staging/prod
   - **Type "DESTROY" to confirm:** –≤–≤–µ—Å—Ç–∏ `DESTROY`
   - **Destroy EKS infrastructure:** ‚úÖ/‚ùå
   - **Destroy Infra infrastructure:** ‚úÖ/‚ùå

### **2. –ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è:**

#### **EKS Project (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ):**
- ‚úÖ EKS –∫–ª–∞—Å—Ç–µ—Ä
- ‚úÖ VPC –∏ –ø–æ–¥—Å–µ—Ç–∏
- ‚úÖ Security Groups
- ‚úÖ IAM —Ä–æ–ª–∏
- ‚úÖ LoadBalancer (–µ—Å–ª–∏ –µ—Å—Ç—å)

#### **Infra Project (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ):**
- ‚úÖ VPC –∏ –ø–æ–¥—Å–µ—Ç–∏
- ‚úÖ K3s –∫–ª–∞—Å—Ç–µ—Ä
- ‚úÖ Database
- ‚úÖ Bastion Host
- ‚úÖ App Server
- ‚úÖ Security Groups

## üîç **–ü—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

### **1. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:**
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ `DESTROY` –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —É–¥–∞–ª—è—Ç—å

### **2. Pre-destroy checks:**
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö AWS —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- EKS –∫–ª–∞—Å—Ç–µ—Ä—ã
- EC2 –∏–Ω—Å—Ç–∞–Ω—Å—ã
- S3 buckets

### **3. Post-destroy verification:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ä–µ—Å—É—Ä—Å—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–µ–Ω—ã
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Ä–µ—Å—É—Ä—Å–∞—Ö

## üìä **–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞:**

### **Destroy Report:**
- **–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è** —É–¥–∞–ª–µ–Ω–∏—è
- **Environment** –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **–°–ø–∏—Å–æ–∫ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤**
- **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**

## üõ†Ô∏è **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

### **GitHub Secrets:**
```bash
AWS_ACCESS_KEY_ID      # AWS Access Key
AWS_SECRET_ACCESS_KEY  # AWS Secret Key
```

### **AWS Permissions:**
- S3 (—á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å state —Ñ–∞–π–ª–æ–≤)
- EKS (—É–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤)
- EC2 (—É–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)
- VPC (—É–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Ç–µ–π)
- IAM (—É–¥–∞–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π)

## üîç **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
- **Actions** ‚Üí **Terraform Destroy Infrastructure** ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π workflow
- **Logs** ‚Üí –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —É–¥–∞–ª–µ–Ω–∏—è

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è:**
```bash
# EKS –∫–ª–∞—Å—Ç–µ—Ä—ã
aws eks list-clusters --region us-east-2

# EC2 –∏–Ω—Å—Ç–∞–Ω—Å—ã
aws ec2 describe-instances --region us-east-2

# S3 buckets (–æ—Å—Ç–∞—é—Ç—Å—è –¥–ª—è state —Ñ–∞–π–ª–æ–≤)
aws s3 ls | grep terraform-state
```

## üßπ **–û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è:**

### **1. S3 Buckets (–æ—Å—Ç–∞—é—Ç—Å—è):**
```bash
# –£–¥–∞–ª–∏—Ç—å state —Ñ–∞–π–ª—ã (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
aws s3 rm s3://go-app-terraform-state-211125755493/ --recursive
aws s3 rm s3://new-project-terraform-state-211125755493/ --recursive

# –£–¥–∞–ª–∏—Ç—å buckets (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
aws s3 rb s3://go-app-terraform-state-211125755493
aws s3 rb s3://new-project-terraform-state-211125755493
```

### **2. ECR Repository (–æ—Å—Ç–∞–µ—Ç—Å—è):**
```bash
# –£–¥–∞–ª–∏—Ç—å ECR repository (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
aws ecr delete-repository --repository-name go-app --region us-east-2 --force
```

## ‚ö†Ô∏è **Troubleshooting:**

### **–û—à–∏–±–∫–∞ "Resources still exist":**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã –æ—Å—Ç–∞–ª–∏—Å—å
aws eks list-clusters --region us-east-2
aws ec2 describe-instances --region us-east-2

# –£–¥–∞–ª–∏—Ç—å –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
```

### **–û—à–∏–±–∫–∞ "State file locked":**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DynamoDB locks (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
aws dynamodb list-tables --region us-east-2
```

## üéØ **Best Practices:**

### **1. –ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º:**
- ‚úÖ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –£–≤–µ–¥–æ–º–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –æ –ø–ª–∞–Ω–∞—Ö —É–¥–∞–ª–µ–Ω–∏—è

### **2. –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã —É–¥–∞–ª–µ–Ω—ã
- ‚úÖ –û—á–∏—Å—Ç–∏—Ç—å S3 buckets (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- ‚úÖ –£–≤–µ–¥–æ–º–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

## üéâ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

1. **üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
2. **üìä –ö–æ–Ω—Ç—Ä–æ–ª—å** - –≤—ã–±–æ—Ä, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —É–¥–∞–ª—è—Ç—å
3. **üîç –ü—Ä–æ–≤–µ—Ä–∫–∏** - –¥–æ –∏ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
4. **üìã –û—Ç—á–µ—Ç—ã** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ–± —É–¥–∞–ª–µ–Ω–∏–∏
5. **üßπ –û—á–∏—Å—Ç–∫–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üöÄ **–ì–æ—Ç–æ–≤–æ!**

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± —É–¥–∞–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
- ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ **–í—ã–±–æ—Ä–æ—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** –¥–æ –∏ –ø–æ—Å–ª–µ
- ‚úÖ **–ü–æ–ª–Ω—ã–µ –æ—Ç—á–µ—Ç—ã** –æ–± —É–¥–∞–ª–µ–Ω–∏–∏

**–ü–æ–º–Ω–∏—Ç–µ: —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!** üóëÔ∏è
